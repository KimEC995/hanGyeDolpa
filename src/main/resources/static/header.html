<!DOCTYPE html>
<html>
<body>
      <div id="mainHeader">
          <a href="/headerTest"><img id="mainHeaderLogo" src="img/logo.png" width="110"></a>
          
          <div id="checkLogin"></div>
      </div>
      <table id="mainHeaderTableBar">
          <tbody>
              <tr>
                  <td><a href="#" onclick="SPA_MovePage('/aboutServicePage')">서비스 소개</a></td>
                  <td><a href="#" onclick="SPA_MovePage('/dashBoardTest')">대시보드</a></td>
                  <td><a href="#" onclick="SPA_MovePage('/communityTest')">커뮤니티</a></td>
                  <td><a href="#" onclick="SPA_MovePage('/locationTest')">클라이밍 위치</a></td>
              </tr>
          </tbody>
      </table>
      <br>
      
      <article></article>
</body>

<script>

	const articleElement = document.querySelector('article');
	const loginDiv = document.getElementById("checkLogin");
	var loginDivTags = '';
	
	fetch("/mainHeaderCheckUserLogin")
	   .then(resp => resp.json())
	   .then(data => {
	   	console.log("Flag: " + data.flag);
	
	       if (data.flag) {
	    	   let tag = "'/userProfileTest'";
	           //console.log(data.user.userAlias);
	    	   loginDivTags = '<p>환영합니다!' + data.user.userAlias;
	    	   loginDivTags += '</p>';
	    	   loginDivTags += '<a href="#" onclick="SPA_MovePage(' + tag + ')"><img id="userProfile" src="'+ data.user.userProfilePath +'"></a>';
	       
	       	console.log(loginDivTags);
	       }
	       else {
	   	   		//console.log("로그인없슴");
	    	   loginDivTags += '<a href="/loginTest">로그인</a>';
	       }
	       
	       loginDiv.innerHTML = loginDivTags;
	   })
	   
	   .catch(err => {
		   console.error("Fetch error:", err);
	   });
	
	async function SPA_MovePage(msg){
		
		articleElement.innerHTML = "Loading...";
		
		try{
			const resp = await fetch(msg);
			
			if(!resp.ok){
				throw new Error(`HTTP error! status: ${response.status}`);
			}
			
			const text = await resp.text();
	        articleElement.innerHTML = text;
	        
	        const parentDIV = document.querySelector('#headerTest');
	        if (parentDIV) {
	        	parentDIV.style.display = 'none';
	            // parentH1.remove();
	        }
		}
		catch(e){
	        console.error("About-Page Fetch error:", e);
	        articleElement.innerHTML = "페이지 로드 실패ㅠㅠ";
		}
	}

 </script>
</html>